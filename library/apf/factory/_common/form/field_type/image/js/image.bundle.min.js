/*! Admin Page Framework - Image Field Type 0.1.0 */
var apfMain=AdminPageFrameworkScriptFormMain,apfImage=AdminPageFrameworkImageFieldType;apfImage.hasMediaUploader=!!apfImage.hasMediaUploader,function(e){var t;!function(...e){if(!parseInt(apfMain.debugMode))return;console.log("APF Image Field Type",...e)}("0.1.0",apfImage),e(document).ready((function(){if(apfImage.hasMediaUploader)t=function(t,a,r){var n,l=!1,d=e("#"+t+'[data-show_preview="1"]');d.off("change"),d.on("change",(function(t){var a=e(this).val();e("<img>",{src:a,error:function(){},load:function(){}})}));var o=e("#select_image_"+t);function m(t,a,i){l||e("#"+t).val()!==a.url&&(i=void 0===i?100:i,setTimeout((function(){e("#"+t).trigger("change")}),i))}function p(e,t,a){a=void 0===a?100:a,setTimeout((function(){l||i(e,t),l=!1}),a)}o.off("click"),o.on("click",(function(t){var i=e(this).attr("id").substring(13),d=e("#"+i);if(window.wpActiveEditor=null,t.preventDefault(),"object"!=typeof n)return oAdminPageFrameworkOriginalImageUploaderSelectObject=wp.media.view.MediaFrame.Select,wp.media.view.MediaFrame.Select=r?getAdminPageFrameworkCustomMediaUploaderSelectObject():oAdminPageFrameworkOriginalImageUploaderSelectObject,(n=wp.media({id:i,title:r?apfImage.label.insertFromURL:apfImage.label.uploadImage,button:{text:apfImage.label.useThisImage},type:"image",library:{type:d.data("mime_types").length?d.data("mime_types"):"image"},multiple:a,metadata:{}})).on("escape",(function(){return l=!0,!1})),n.on("close",(function(){var t,a=n.state();if(void 0!==a.props&&void 0!==a.props.attributes){var r,l={};for(r in a.props.attributes)l[r]=a.props.attributes[r]}void 0!==l?(p(i,l),m(i,l)):n.state().get("selection").each((function(a,r){var n=a.hasOwnProperty("attributes")?a.attributes:{};if(0===r)return p(i,n),m(i,n),!0;var l=void 0===t?e("#"+i).closest(".admin-page-framework-field"):t,d=(t=e(this).addAdminPageFrameworkRepeatableField(l.attr("id"))).find("input").attr("id");p(d,n),m(d,n)}));return wp.media.view.MediaFrame.Select=oAdminPageFrameworkOriginalImageUploaderSelectObject,!1})),n.open(),!1;n.open()}))};else{t=function(t,i,r){var n=e("#select_image_"+t);n.off("click"),n.on("click",(function(){var t=e(this).attr("id");window.sInputID=t.substring(13),window.original_send_to_editor=window.send_to_editor,window.send_to_editor=a;var i=e(this).attr("data-enable_external_source");return tb_show(apfImage.label.uploadImage,"media-upload.php?post_id=1&amp;enable_external_source="+i+"&amp;referrer={$sReferrer}&amp;button_label="+apfImage.label.useThisImage+"&amp;type=image&amp;TB_iframe=true",!1),!1}))};var a=function(t){var a="<div>"+t+"</div>",i=e("img",a).attr("src"),r=e("img",a).attr("alt"),n=e("img",a).attr("title"),l=e("img",a).attr("width"),d=e("img",a).attr("height"),o=e("img",a).attr("class"),m=o?o.replace(/(.*?)wp-image-/,""):"",p=t.replace(/\[(\w+).*?\](.*?)\[\/(\w+)\]/m,"$2").replace(/<a.*?>(.*?)<\/a>/m,""),g=t.replace(/^.*?\[\w+.*?\salign=(['"])(.*?)['"]\s.+$/gm,"$2"),c=e(a).find("a:first").attr("href");p=e("<div/>").text(p).html();var s=e("<div/>").text(r).html();n=e("<div/>").text(n).html();var u=window.sInputID;e("#"+u).val(i),e("#"+u+"_id").val(m),e("#"+u+"_width").val(l),e("#"+u+"_height").val(d),e("#"+u+"_caption").val(p),e("#"+u+"_alt").val(s),e("#"+u+"_title").val(n),e("#"+u+"_align").val(g),e("#"+u+"_link").val(c);var _=e("#image_preview_"+u);_.attr("alt",r),_.attr("title",n),_.attr("data-classes",o),_.attr("data-id",m),_.attr("src",i),e("#image_preview_container_"+u).css("display",""),_.show(),window.send_to_editor=window.original_send_to_editor,tb_remove()}}function i(t,a){a=e.extend(!0,{caption:"",alt:"",title:"",url:"",id:"",width:"",height:"",align:"",link:""},a);var i=e("<div/>").text(a.caption).html(),r=e("<div/>").text(a.alt).html(),n=e("<div/>").text(a.title).html();e("input#"+t).val(a.url),e("input#"+t+"_id").val(a.id),e("input#"+t+"_width").val(a.width),e("input#"+t+"_height").val(a.height),e("input#"+t+"_caption").val(i),e("input#"+t+"_alt").val(r),e("input#"+t+"_title").val(n),e("input#"+t+"_align").val(a.align),e("input#"+t+"_link").val(a.link);var l=e("#image_preview_"+t);l.attr("data-id",a.id),l.attr("data-width",a.width),l.attr("data-height",a.height),l.attr("data-caption",i),l.attr("alt",r),l.attr("title",n),l.attr("src",a.url),a.url?e("#image_preview_container_"+t).show():e("#image_preview_container_"+t).hide()}e().registerAdminPageFrameworkCallbacks({repeated_field:function(a,r){1===r.call_type&&a.find("input").first().val()||(a.find(".image_preview").hide(),a.find(".image_preview img").attr("src","")),a.find(".image_preview, .image_preview img, .select_image.button, .remove_image.button").incrementAttributes(["id","data-input_id"],r.incremented_from,r.id);var n=a.closest(".admin-page-framework-field"),l=n.find(".select_image"),d=n.find(".image-field input");if(d.length<=0)return!0;t(d.attr("id"),!0,l.attr("data-enable_external_source")),e("#remove_image_"+d.attr("id")+".remove_image.button").on("click",(function(t){return i(e(this).data("input_id"),{}),!1}))}},apfImage.fieldTypeSlugs),e(".select_image.button").each((function(){t(e(this).data("input_id"),e(this).data("repeatable"),e(this).data("enable_external_source"))})),e(".remove_image.button").on("click",(function(t){return i(e(this).data("input_id"),{}),e("#"+e(this).data("input_id")).trigger("change"),!1}))}))}(jQuery);
